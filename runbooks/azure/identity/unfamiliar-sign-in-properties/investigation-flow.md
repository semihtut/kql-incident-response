---
title: "Unfamiliar Sign-In Properties"
id: RB-0001
severity: medium
status: reviewed
description: >
  Investigation runbook for Microsoft Entra ID Identity Protection
  "Unfamiliar sign-in properties" risk detection. Covers credential
  compromise via valid accounts, post-access persistence (inbox rules,
  MFA manipulation, OAuth consent), and blast radius assessment.
mitre_attack:
  tactics:
    - tactic_id: TA0001
      tactic_name: "Initial Access"
    - tactic_id: TA0003
      tactic_name: "Persistence"
    - tactic_id: TA0004
      tactic_name: "Privilege Escalation"
    - tactic_id: TA0005
      tactic_name: "Defense Evasion"
    - tactic_id: TA0006
      tactic_name: "Credential Access"
    - tactic_id: TA0008
      tactic_name: "Lateral Movement"
    - tactic_id: TA0009
      tactic_name: "Collection"
  techniques:
    - technique_id: T1078.004
      technique_name: "Valid Accounts: Cloud Accounts"
      confidence: confirmed
    - technique_id: T1098
      technique_name: "Account Manipulation"
      confidence: confirmed
    - technique_id: T1110.003
      technique_name: "Brute Force: Password Spraying"
      confidence: probable
    - technique_id: T1110.004
      technique_name: "Brute Force: Credential Stuffing"
      confidence: probable
    - technique_id: T1114.003
      technique_name: "Email Collection: Email Forwarding Rule"
      confidence: confirmed
    - technique_id: T1528
      technique_name: "Steal Application Access Token"
      confidence: confirmed
    - technique_id: T1530
      technique_name: "Data from Cloud Storage Object"
      confidence: confirmed
    - technique_id: T1534
      technique_name: "Internal Spearphishing"
      confidence: confirmed
    - technique_id: T1539
      technique_name: "Steal Web Session Cookie"
      confidence: possible
    - technique_id: T1556.006
      technique_name: "Modify Authentication Process: MFA"
      confidence: confirmed
    - technique_id: T1564.008
      technique_name: "Hide Artifacts: Email Hiding Rules"
      confidence: confirmed
threat_actors:
  - "Midnight Blizzard (APT29)"
  - "Octo Tempest (Scattered Spider)"
  - "Peach Sandstorm (APT33)"
log_sources:
  - table: "SigninLogs"
    product: "Entra ID"
    license: "Entra ID Free"
    required: true
    alternatives: []
  - table: "AADNonInteractiveUserSignInLogs"
    product: "Entra ID"
    license: "Entra ID P1/P2"
    required: false
    alternatives: []
  - table: "AADUserRiskEvents"
    product: "Entra ID Identity Protection"
    license: "Entra ID P2"
    required: true
    alternatives: []
  - table: "AADRiskyUsers"
    product: "Entra ID Identity Protection"
    license: "Entra ID P2"
    required: true
    alternatives: []
  - table: "AuditLogs"
    product: "Entra ID"
    license: "Entra ID Free"
    required: true
    alternatives: []
  - table: "IdentityInfo"
    product: "Sentinel UEBA"
    license: "Sentinel UEBA"
    required: false
    alternatives: ["AuditLogs (Category == RoleManagement)"]
  - table: "OfficeActivity"
    product: "Office 365"
    license: "M365 E3+"
    required: true
    alternatives: []
  - table: "CloudAppEvents"
    product: "Defender for Cloud Apps"
    license: "MCAS / M365 E5"
    required: false
    alternatives: ["OfficeActivity"]
  - table: "SecurityAlert"
    product: "Microsoft Sentinel"
    license: "Sentinel"
    required: true
    alternatives: []
  - table: "ThreatIntelligenceIndicator"
    product: "Microsoft Sentinel"
    license: "Sentinel + TI feeds"
    required: false
    alternatives: []
  - table: "BehaviorAnalytics"
    product: "Sentinel UEBA"
    license: "Sentinel UEBA"
    required: false
    alternatives: []
author: "Arina (IR), Hasan (Platform), Samet (KQL), Yunus (TI), Alp (QA)"
created: 2026-02-21
updated: 2026-02-21
version: "1.0"
tier: 1
---

# Investigation Flow: Unfamiliar Sign-In Properties

**Designed by:** Arina (IR Architect)
**Status:** v1.0 - Reviewed 2026-02-21
**Alert Source:** Microsoft Entra ID Identity Protection
**Risk Detection Name:** unfamiliarFeatures

---

## 1. Alert Context

**What triggers this alert:**
The "Unfamiliar sign-in properties" risk detection is generated by Entra ID Identity Protection when a user signs in from properties (IP address, location, device, browser, ASN/network) that have not been observed in that user's recent sign-in history. Identity Protection uses a rolling ML model that learns each user's typical sign-in patterns over approximately 30 days. When a sign-in deviates significantly from the learned pattern, it triggers this detection.

**Why it matters:**
This is one of the most common Identity Protection alerts and often the first indicator of credential compromise. An attacker who has obtained valid credentials (via phishing, credential stuffing, dark web purchase, or password spray) will typically sign in from infrastructure that looks nothing like the legitimate user's patterns - different country, different ISP, different device fingerprint.

**However:** This is also one of the highest false-positive alerts. Legitimate triggers include:
- User traveling for business or vacation
- User switching to a new device, browser, or ISP
- User connecting via a new VPN or corporate network change
- First sign-in after a long period of inactivity

**Worst case scenario if this is real:**
An attacker has valid credentials and is actively accessing the user's account. They may be reading email, setting up persistence (inbox rules, MFA device registration, OAuth app consent), and preparing for business email compromise or data exfiltration. Every minute of delay means more potential damage.

---

## 2. Prerequisites

### Minimum Required
- **License:** Entra ID P2 + Microsoft 365 E3 + Microsoft Sentinel
- **Sentinel Connectors:** Microsoft Entra ID, Office 365
- **Permissions:** Security Reader (investigation), Security Operator (containment)

### Recommended for Full Coverage
- **License:** Microsoft 365 E5 + Sentinel with UEBA enabled + TI feeds
- **Additional Connectors:** Defender for Cloud Apps, Threat Intelligence (TAXII/Platform)

### Data Availability Check
Before starting the investigation, verify these tables contain data:
1. Run `AADUserRiskEvents | take 1` - If empty, Entra ID P2 or the connector is missing
2. Run `OfficeActivity | take 1` - If empty, the Office 365 connector is not configured
3. Run `IdentityInfo | take 1` - If empty, UEBA is not enabled (use Query 2A-Fallback for user context)

### Licensing Coverage by Investigation Step

| License Tier | Tables Available | Steps Covered |
|---|---|---|
| Entra ID Free + Sentinel | SigninLogs, AuditLogs, SecurityAlert, ThreatIntelligenceIndicator | Steps 1 (partial), 5 (partial), 6 (partial) |
| Entra ID P2 + Sentinel | Above + AADNonInteractiveUserSignInLogs, AADUserRiskEvents, AADRiskyUsers | Steps 1-4, 6 |
| M365 E3 + Entra ID P2 + Sentinel | Above + OfficeActivity | Steps 1-6 (core investigation) |
| M365 E5 + Sentinel + UEBA | ALL 11 tables | Steps 1-7 (full investigation) |

---

## 3. Quick Triage Criteria

The goal of quick triage is to determine within 2-3 steps whether this alert can be confidently closed as a false positive or requires deep investigation.

### Quick Close Conditions (all must be true to close as FP):
1. The sign-in was **successful AND passed MFA** (user completed a real MFA challenge, not just a cached token)
2. The unfamiliar property is **only the IP/ASN** (not location + device + browser combined)
3. The IP belongs to a **known corporate VPN, cloud proxy, or recognized ISP** in the user's country
4. There is **no other risk event** for this user in the past 7 days
5. There is **no suspicious post-sign-in activity** (no inbox rules, no app consents, no bulk downloads)

### Quick Escalation Conditions (any one triggers deep investigation):
- Sign-in from a country the user has NEVER signed in from before
- Sign-in without MFA or with MFA bypassed
- Multiple unfamiliar properties simultaneously (new IP + new device + new browser + new location)
- Other risk events present for the same user (especially if different types: leaked credentials + unfamiliar sign-in)
- Any post-sign-in activity within 30 minutes that modifies account settings, creates inbox rules, or accesses sensitive resources

---

## 4. Investigation Steps

### Step 1: Extract Alert Entities and Sign-In Details

**Purpose:** Pull the complete sign-in record that triggered the alert. Understand exactly which properties were unfamiliar and the full authentication context.

**Data needed from:**
- Table: AADUserRiskEvents - get the risk event details (RiskEventType, DetectionTimingType, RiskLevel, IpAddress, Location)
- Table: SigninLogs - get the full sign-in record (UserPrincipalName, IPAddress, Location, DeviceDetail, UserAgent, AppDisplayName, ConditionalAccessStatus, AuthenticationRequirement, MfaDetail, ResultType)

**What to extract:**
- User identity: UserPrincipalName, display name, object ID
- Source IP address and geographic location (city, country)
- Device information: OS, browser, device compliance status, managed/unmanaged
- Application being accessed
- Authentication details: MFA completed? Which MFA method? Conditional Access result?
- Risk assessment: Risk level, real-time vs offline detection
- Session ID and correlation ID for event chaining

**Expected findings:**

| Finding | Malicious Indicator | Benign Indicator |
|---|---|---|
| Location | Country user has never signed in from | User's home country, known travel destination |
| Device | Unknown device, non-compliant | Corporate-managed device, recently enrolled |
| Browser | Unusual browser (e.g., Python requests, curl, old browser version) | Standard browser (Chrome, Edge, Safari) |
| MFA | Not challenged, or MFA failed, or legacy auth bypassed MFA | MFA successfully completed with standard method |
| Conditional Access | Not applied or failed | Successfully applied and passed |
| Detection timing | Real-time (suspicious enough to catch live) | Offline (lower confidence, detected in batch) |

**Next action:**
- If MFA passed + managed device + known location → proceed to Step 2 with low concern, may quick close
- If MFA not completed OR unknown device + unknown location → proceed to Step 2 with high concern
- If ResultType != 0 (sign-in failed) → still investigate the IP and check for other attempts, but lower priority

---

### Step 2: Check User Context and Account Status

**Purpose:** Understand who this user is and whether the account is a high-value target. Check for recent account changes that might indicate the account was already compromised.

**Data needed from:**
- Table: IdentityInfo - get user metadata (Department, JobTitle, AssignedRoles, GroupMemberships)
- Table: AuditLogs - check for recent account changes (password reset, MFA method changes, new device registration)

**What to look for:**
- Is this a privileged account? (Global Admin, Security Admin, Exchange Admin, or member of sensitive groups)
- Is this an executive or finance team member? (high BEC risk)
- Has the password been changed recently? (could indicate password was reset after compromise, or attacker changed it)
- Were new MFA methods registered recently? (attacker registering their own MFA device)
- Were new devices registered recently? (T1098.005 - rogue device join)
- Is this a shared account or service account? (higher risk due to weaker controls)

**Expected findings:**

| Finding | Malicious Indicator | Benign Indicator |
|---|---|---|
| Role | Privileged role (Global Admin, etc.) | Standard user |
| Recent MFA change | New MFA method registered within last 72 hours from unfamiliar IP | No recent MFA changes, or change from known IP |
| Recent password change | Password changed within last 48 hours | No recent password change |
| New device registration | New device registered from unfamiliar location | No new devices |
| Account status | Account recently re-enabled after being disabled | Account has been active continuously |

**Next action:**
- If privileged account → increase priority regardless of other findings
- If recent MFA/password changes detected → proceed to Step 3 with high concern, likely attacker establishing persistence
- If standard user with no recent changes → proceed to Step 3

---

### Step 3: Baseline Comparison - Establish Normal Behavior Pattern

**Purpose:** Determine what "normal" looks like for this specific user. Compare the flagged sign-in against 30 days of historical sign-in data. This is the most critical step - you cannot call something anomalous if you do not know what normal looks like.

**Label:** Step 3: Baseline Comparison - Establish Normal Behavior Pattern

**Data needed from:**
- Table: SigninLogs - pull 30 days of historical sign-ins for this specific user
- Table: AADNonInteractiveUserSignInLogs - pull 30 days of non-interactive sign-ins (for complete IP/location picture)

**Baseline metrics to calculate:**
- Average daily sign-in count (interactive + non-interactive)
- Distinct IP addresses per day (typical range)
- Distinct locations (countries, cities) over 30 days
- Distinct devices and browsers used
- Distinct applications accessed
- Typical sign-in hours (business hours vs off-hours pattern)
- Typical ISP/ASN values

**What to compare against current sign-in:**
- Is the IP address new? (never seen in 30-day baseline)
- Is the location new? (never seen in 30-day baseline)
- Is the device/browser new? (never seen in 30-day baseline)
- Is the sign-in time unusual? (outside typical hours for this user)
- Is the application unusual? (user never accessed this app before)
- How many standard deviations is today's activity from the baseline?

**Expected findings:**

| Finding | Malicious Indicator | Benign Indicator |
|---|---|---|
| IP history | IP never seen for this user in 30 days, and not in same ASN as known IPs | IP is in same ASN range as user's known IPs, or was seen weeks ago |
| Location history | Country never seen in 30-day history | User has signed in from this country before |
| Device/browser | Device fingerprint never seen AND browser never seen | User recently started using this device/browser (gradual transition visible) |
| Sign-in time | Sign-in at 3 AM local time when user only signs in during business hours | Sign-in during user's typical working hours |
| Application | User never accessed this application before | Application is in user's regular access pattern |
| Activity volume | Sudden spike in sign-in volume (>2 std dev above baseline) | Normal daily volume |

**Next action:**
- If all metrics are within normal range → likely false positive, proceed to Step 4 for final verification then close
- If 1-2 metrics are anomalous → proceed to Step 4 with moderate concern
- If 3+ metrics are anomalous → proceed to Step 4 and Step 5 with high concern, prepare for containment

---

### Step 4: Check for Correlated Risk Events

**Purpose:** Determine if this unfamiliar sign-in is an isolated event or part of a pattern. Multiple risk events for the same user dramatically increase the probability of true compromise.

**Data needed from:**
- Table: AADUserRiskEvents - all risk events for this user in the past 7 days
- Table: AADRiskyUsers - current risk state of the user
- Table: SecurityAlert - any other alerts for entities associated with this sign-in (same IP, same user)

**What to look for:**
- Other risk detections for the same user (leaked credentials, anonymous IP, impossible travel, anomalous token, MFA fatigue)
- Other users with risk events from the same IP address (indicates shared attack infrastructure)
- Time clustering: multiple risk events within a short window (hours) vs spread over days
- Risk escalation pattern: events getting progressively more severe

**Expected findings:**

| Finding | Malicious Indicator | Benign Indicator |
|---|---|---|
| Other risk events | Multiple risk event types for same user in 7 days | This is the only risk event for the user |
| Same IP - other users | Same IP generated risk events for multiple users | IP only flagged for this one user |
| Risk state | User risk state is "atRisk" or "confirmedCompromised" | Risk state is "none" or previously "remediated" |
| Time clustering | Multiple events within 1-4 hours | Single isolated event |
| Leaked credentials | Leaked credential detection present | No leaked credential detections |

**Next action:**
- If multiple risk event types present → HIGH confidence of compromise, proceed to Step 5 and prepare containment
- If leaked credentials + unfamiliar sign-in → VERY HIGH confidence, this is classic credential compromise pattern
- If same IP flagged for multiple users → potential password spray or shared attack infrastructure, escalate
- If isolated single event → proceed to Step 5 for post-sign-in activity check

---

### Step 5: Analyze Post-Sign-In Activity (Blast Radius Assessment)

**Purpose:** Determine what the account did AFTER the suspicious sign-in. This is where you find evidence of actual compromise - attackers typically act quickly after gaining access. Check for persistence mechanisms, data access, and lateral movement indicators.

**Data needed from:**
- Table: AuditLogs - directory changes made by this user in the 4 hours following the sign-in
- Table: OfficeActivity - email, SharePoint, OneDrive, Teams activity in the 4 hours following the sign-in
- Table: CloudAppEvents - SaaS app activity in the 4 hours following the sign-in

**What to look for (persistence):**
- Inbox rule creation (New-InboxRule) - especially rules that forward/redirect or delete incoming mail
- Email forwarding configuration (Set-Mailbox with ForwardingSmtpAddress)
- Mailbox delegate permissions added (Add-MailboxPermission)
- OAuth application consent granted (especially with Mail.Read, Mail.ReadWrite, Files.ReadWrite.All)
- MFA method registration or modification
- New device registration

**What to look for (data access):**
- Bulk email access (MailItemsAccessed with large volume)
- Mass file downloads from SharePoint/OneDrive (FileDownloaded with high count)
- Email search activity (unusual search patterns)
- Access to sensitive resources (finance folders, HR data, executive mailboxes)

**What to look for (lateral movement):**
- Internal phishing attempts (emails sent to other users from the compromised account)
- Teams messages sent with suspicious links
- Shared file links created and sent to external recipients

**Expected findings:**

| Finding | Malicious Indicator | Benign Indicator |
|---|---|---|
| Inbox rules | New rule created that forwards/deletes email | No new inbox rules |
| Email forwarding | Forwarding set to external address | No forwarding changes |
| OAuth apps | New app consent with broad permissions | No new app consents |
| File access | Bulk download of files from SharePoint/OneDrive (>50 in 1 hour) | Normal file access pattern |
| Email access | Mass mailbox access (MailItemsAccessed > 100 in 1 hour) | Normal email reading pattern |
| Sent emails | Phishing-like emails sent to multiple internal users | No unusual sent mail |
| MFA changes | New MFA method registered from unfamiliar IP | No MFA changes |

**Next action:**
- If ANY persistence mechanism found (inbox rule, forwarding, OAuth app, MFA change) → CONFIRMED COMPROMISE, proceed to Containment immediately
- If bulk data access found → CONFIRMED COMPROMISE with data exposure, proceed to Containment + Data Loss Assessment
- If no suspicious post-sign-in activity → proceed to Step 6 for final determination
- If sign-in failed (ResultType != 0) → limited post-sign-in activity expected, check for password spray pattern

---

### Step 6: Check Source IP Reputation and Context

**Purpose:** Gather intelligence about the source IP address. Determine if it belongs to known attack infrastructure, anonymous proxies, hosting providers, or legitimate ISPs.

**Data needed from:**
- Table: ThreatIntelligenceIndicator - check if IP appears in any TI feeds
- Table: SigninLogs - check if this IP has been used by other legitimate users in the organization
- Table: BehaviorAnalytics - check if UEBA has flagged this IP or the user

**What to look for:**
- Is the IP in threat intelligence feeds? (known malicious, C2, proxy)
- Is the IP from a VPN provider, Tor exit node, or hosting provider? (common attacker infrastructure)
- Is the IP from a residential ISP in a suspicious country?
- Has this IP been used by any other users in the organization? (if yes, more likely legitimate corporate exit IP)
- Does the ASN match known corporate VPN or proxy services?
- Has UEBA flagged this as a first-time ISP for the user?

**Expected findings:**

| Finding | Malicious Indicator | Benign Indicator |
|---|---|---|
| TI match | IP found in threat intelligence feeds | IP not in any TI feeds |
| IP type | VPS/hosting provider, Tor exit node, anonymous proxy | Residential or corporate ISP |
| Org usage | IP not used by any other user in the organization | IP used by multiple other users (corporate exit IP) |
| UEBA | First-time ISP flagged by UEBA | ISP seen before for this user |
| Geolocation | IP geolocates to high-risk country with no business presence | IP geolocates to country where organization operates |

**Next action:**
- If IP is in TI feeds → HIGH confidence of compromise, proceed to Containment
- If IP is from hosting/VPN provider + other indicators → HIGH confidence
- If IP is from legitimate ISP + used by other org users → LOWER concern, likely false positive
- If inconclusive → make final determination based on totality of Steps 1-6

---

### Step 7: Final Determination and Classification

**Purpose:** Based on all evidence gathered in Steps 1-6, make a final classification.

**Classification matrix:**

| Classification | Criteria | Action |
|---|---|---|
| **True Positive - Confirmed Compromise** | Post-sign-in persistence found (inbox rules, OAuth app, MFA changes) AND/OR multiple risk events AND/OR TI-matched IP | Immediate containment (see Containment Playbook) |
| **True Positive - Likely Compromise** | Multiple anomalous baseline metrics + suspicious IP + no MFA, but no confirmed post-sign-in abuse yet | Containment recommended, contact user for confirmation |
| **Benign True Positive** | Alert correctly fired (properties ARE unfamiliar) but verified as legitimate user activity (confirmed travel, new device, VPN change) | Close as BTP, document reason, consider tuning |
| **False Positive** | Alert fired due to routine change (ISP rotation, CDN IP, browser update) with all other indicators clean | Close as FP, add to tuning notes |

---

## 5. Containment Playbook

Execute in this order. IMPORTANT: Collect evidence (Step 7 checklist) BEFORE taking containment actions that could alert the attacker or destroy evidence.

### Immediate Actions (within 15 minutes of confirmed compromise):

1. **Revoke all active sessions** - Revoke the user's refresh tokens via Entra ID to immediately invalidate all active sessions. This forces re-authentication on all devices and applications.

2. **Reset password** - Reset the user's password to a strong temporary password. Do NOT communicate the new password via the potentially compromised email account - use an out-of-band channel (phone call, SMS, manager).

3. **Disable suspicious inbox rules** - If inbox rules were created for forwarding/deletion, disable them immediately before the attacker can use them for further compromise.

4. **Block the source IP** - Add the attacker's IP address to Conditional Access as a blocked location (if using named locations) or to the organization's firewall/proxy block list.

### Follow-up Actions (within 1 hour):

5. **Review and remove unauthorized MFA methods** - If the attacker registered a new MFA method, remove it. Verify remaining MFA methods with the user through out-of-band channel.

6. **Revoke OAuth application consents** - If unauthorized applications were granted consent, revoke the application permissions in Entra ID Enterprise Applications.

7. **Remove email forwarding rules** - Check and remove any mailbox forwarding rules (both inbox rules and mailbox-level forwarding via Set-Mailbox).

8. **Review mailbox delegate permissions** - Remove any unauthorized delegate or full-access permissions added to the mailbox.

### Extended Actions (within 24 hours):

9. **Notify the user** - Contact the user via out-of-band channel. Confirm the sign-in was not theirs. Instruct them to re-register MFA and change password.

10. **Check for data exposure** - Review what data was accessed during the compromise window. Determine if notification is required (PII exposure, regulated data).

11. **Hunt for related compromise** - Check if the same attacker IP/infrastructure was used against other accounts. Run the source IP against all sign-in logs.

12. **Review Conditional Access policies** - Determine if a CA policy gap allowed this access (e.g., no MFA requirement for the accessed application, legacy auth allowed).

---

## 6. Evidence Collection Checklist

Preserve the following BEFORE taking containment actions:

- [ ] Full sign-in record from SigninLogs (all columns, not just key columns)
- [ ] Risk event record from AADUserRiskEvents
- [ ] User risk state from AADRiskyUsers
- [ ] 30-day sign-in baseline for the user (SigninLogs + AADNonInteractiveUserSignInLogs)
- [ ] All AuditLogs entries for the user in the 72 hours surrounding the event
- [ ] All OfficeActivity records for the user in the 72 hours surrounding the event
- [ ] Inbox rules snapshot (current state before remediation)
- [ ] Mailbox forwarding configuration snapshot
- [ ] OAuth application consent list for the user
- [ ] MFA registration details for the user
- [ ] IP reputation and TI lookup results
- [ ] UEBA/BehaviorAnalytics records for the user
- [ ] Screenshot of the risk event in the Entra ID portal
- [ ] Timeline of all events (chronological reconstruction)

---

## 7. Escalation Criteria

### Escalate to Senior Analyst when:
- The compromised account is a Global Administrator or Security Administrator
- Multiple users appear compromised from the same attack infrastructure
- Evidence of data exfiltration is found (bulk downloads, email forwarding to external)
- The attacker has registered persistence mechanisms (OAuth apps with broad permissions)
- The compromise timeline exceeds 48 hours (attacker had extended access)

### Escalate to Customer/Management when:
- Confirmed credential compromise with verified post-sign-in abuse
- Any data exposure involving PII, financial data, or regulated information
- Compromise of executive or finance team accounts (high BEC risk)
- Evidence of internal phishing from the compromised account (other users may be affected)
- The attack pattern suggests a targeted campaign (not opportunistic)

### Escalate to Incident Response Team when:
- Evidence of nation-state or advanced persistent threat (APT) tactics
- Compromise has spread to multiple accounts
- Attacker has gained administrative privileges
- Evidence of Azure resource access or subscription-level changes
- Ransomware precursors detected (mass credential harvesting, lateral movement tools)

---

## 8. False Positive Documentation

### Common Benign Scenarios

**1. User traveling for business**
- Pattern: Unfamiliar location (different country/city) but sign-in time aligns with travel schedule
- How to confirm: Check calendar for travel events, ask user or manager via out-of-band channel
- Tuning note: Consider creating named locations for common travel destinations

**2. New corporate VPN or proxy deployment**
- Pattern: Multiple users trigger unfamiliar sign-in from the same new IP range simultaneously
- How to confirm: Check with IT if VPN/proxy infrastructure changed, verify IP belongs to known VPN provider
- Tuning note: Add new VPN IP ranges to named/trusted locations in Conditional Access

**3. User's ISP rotated IP addresses**
- Pattern: Only IP/ASN changed, device + browser + location all remain the same
- How to confirm: IP geolocates to user's known city, ISP matches user's known provider
- Tuning note: This is expected behavior, generally safe to close if only property is IP change within same location

**4. New device or browser**
- Pattern: User switched to new laptop/phone or updated browser, all other properties normal
- How to confirm: Device is managed/compliant in Intune, or user confirms new device through out-of-band channel
- Tuning note: Managed/compliant devices should be weighted lower for unfamiliar device alerts

**5. First sign-in after extended absence**
- Pattern: User returns from leave, sabbatical, or long absence. ML baseline has decayed
- How to confirm: Check HR records or manager confirmation of absence
- Tuning note: Accounts inactive for >30 days will trigger on first sign-in due to baseline expiration

**6. Seasonal workers or contractors**
- Pattern: Users who only sign in during specific periods (seasonal, project-based)
- How to confirm: Verify employment type and expected access pattern
- Tuning note: Consider separate risk policies for contractor/seasonal accounts

---

## 9. Investigation Step Summary

| Step | Name | Purpose | Tables Needed | Priority |
|---|---|---|---|---|
| 1 | Extract Alert Entities | Get full sign-in and risk event context | AADUserRiskEvents, SigninLogs | Required |
| 2 | User Context & Account Status | Understand target value and recent changes | IdentityInfo, AuditLogs | Required |
| 3 | Baseline Comparison | Establish 30-day normal pattern | SigninLogs, AADNonInteractiveUserSignInLogs | **MANDATORY** |
| 4 | Correlated Risk Events | Check for other detections on same user/IP | AADUserRiskEvents, AADRiskyUsers, SecurityAlert | Required |
| 5 | Post-Sign-In Activity | Find persistence, data access, lateral movement | AuditLogs, OfficeActivity, CloudAppEvents | Required |
| 6 | IP Reputation & Context | Assess source IP risk | ThreatIntelligenceIndicator, SigninLogs, BehaviorAnalytics | Required |
| 7 | Final Determination | Classify and decide | All above | Required |



## References

- [MITRE ATT&CK T1078.004 - Valid Accounts: Cloud Accounts](https://attack.mitre.org/techniques/T1078/004/)
- [Microsoft Entra ID Identity Protection Risk Detections](https://learn.microsoft.com/en-us/entra/id-protection/concept-identity-protection-risks)
- [Microsoft Sentinel SigninLogs Schema](https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/signinlogs)
- [Investigating Risk - Microsoft Identity Protection](https://learn.microsoft.com/en-us/entra/id-protection/howto-identity-protection-investigate-risk)
